
CREATE VIEW [EMBCPROD].[V_TIP_INTEL_SUBMISSION_REPORT] (
   UNIQUE_KEY, 
   HISTORY_VERSION, 
   DELETED, 
   TIP_INTEL_NUMBER, 
   TIP_INTEL_AGENCY, 
   TIP_INTEL_DATETIME, 
   TIP_INTEL_LEADAGENCY, 
   TIP_INTEL_SYNOPSIS, 
   TIP_INTEL_STATUS, 
   CREATION_DATE, 
   CREATED_BY, 
   MODIFICATION_DATE, 
   MODIFIED_BY, 
   INDIVIDUAL, 
   ORGANIZATION, 
   POSITION, 
   AGENCY, 
   COL_TIPTSACATEGORY, 
   COL_TIPTSACLASS, 
   COL_TIPTSAINFSECTOR)
AS 
   SELECT 
      TS.UNIQUE_KEY, 
      TS.HISTORY_VERSION, 
      TS.DELETED, 
      TS.TIP_INTEL_NUMBER, 
      TS.TIP_INTEL_AGENCY, 
      TS.TIP_INTEL_DATETIME, 
      TS.TIP_INTEL_LEADAGENCY, 
      TS.TIP_INTEL_SYNOPSIS, 
      TS.TIP_INTEL_STATUS, 
      TS.CREATION_DATE, 
      TS.CREATED_BY, 
      TS.MODIFICATION_DATE, 
      TS.MODIFIED_BY, 
      RESP.INDIVIDUAL, 
      RESP.ORGANIZATION, 
      RESP.POSITION, 
      RESP.AGENCY, 
      TSA.COL_TIPTSACATEGORY, 
      TSA.COL_TIPTSACLASS, 
      TSA.COL_TIPTSAINFSECTOR
   FROM 
      EMBCPROD.V_TIP_INTEL_REPORT  AS TS 
         LEFT JOIN 
         (
            SELECT 
               REPT.GLOBAL_REPORT_ID, 
               RSP.INDIVIDUAL, 
               RSP.ORGANIZATION, 
               RSP.POSITION, 
               RSP.AGENCY
            FROM EMBCPROD.TBL_REPORT  AS REPT, EMBCPROD.TBL_RESPONSIBLE_ENTITY  AS RSP
            WHERE 
               REPT.REPORT_TYPE = 'tip_intel' AND 
               REPT.STATUS = 'A' AND 
               REPT.ENTITY_ID = RSP.ENTITY_ID
         )  AS RESP 
         ON TS.UNIQUE_KEY = RESP.GLOBAL_REPORT_ID 
         LEFT JOIN 
         (
            SELECT V_TIP_INTEL_TSA_REPORT.COL_TIPINTELPARENTID, V_TIP_INTEL_TSA_REPORT.COL_TIPTSACATEGORY, V_TIP_INTEL_TSA_REPORT.COL_TIPTSACLASS, V_TIP_INTEL_TSA_REPORT.COL_TIPTSAINFSECTOR
            FROM EMBCPROD.V_TIP_INTEL_TSA_REPORT
            WHERE V_TIP_INTEL_TSA_REPORT.HISTORY_VERSION = 'No' AND V_TIP_INTEL_TSA_REPORT.DELETED = 'No'
         )  AS TSA 
         ON TS.TIP_INTEL_NUMBER = TSA.COL_TIPINTELPARENTID

GO
EXECUTE sp_addextendedproperty @name = N'MS_SSMA_SOURCE', @value = N'EMBCPROD.V_TIP_INTEL_SUBMISSION_REPORT', @level0type = N'SCHEMA', @level0name = N'EMBCPROD', @level1type = N'VIEW', @level1name = N'V_TIP_INTEL_SUBMISSION_REPORT';

