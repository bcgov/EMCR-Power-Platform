
CREATE VIEW [EMBCPROD].[V_VOLUNTEER] (
   UNIQUE_KEY, 
   HISTORY_VERSION, 
   DELETED, 
   FOREIGN_DOC, 
   WEB_PAGE_LINK, 
   DATASHARE_COMMENTS, 
   OWNED_BY, 
   STATUS, 
   VT_WORKER_CATEGORY, 
   VT_LAST_NAME, 
   VT_FIRST_NAME, 
   VT_MIDDLE_INITIAL, 
   RELATED_REPORT_NAME, 
   VT_GENDER, 
   VT_JOB_STATUS, 
   VT_JOB_TITLE, 
   VT_WORK_PHONE, 
   VT_HOME_PHONE, 
   VT_CELL_PHONE, 
   VT_OTHER_PHONE, 
   VT_EMAIL, 
   ORGANIZATION_NAME, 
   POSITION_NAME, 
   VT_AGENCY, 
   VT_STREET_ADDRESS1, 
   VT_STREET_ADDRESS2, 
   VT_CITY, 
   VT_STATE, 
   VT_ZIP, 
   VT_COUNTRY, 
   VT_CITIZENSHIP, 
   VT_PRIMARY_FUNCTION, 
   VT_IS_PRIMARY_SUPERVISOR, 
   VT_SECONDARY_FUNCTION, 
   VT_IS_SECONDARY_SUPERVISOR, 
   VT_DEPL_NOTIF_REQUIRED, 
   VT_DEPL_AVAILABILITY, 
   VT_DEPL_TEAM_NAME, 
   DEPL_ORG_NAME, 
   DEPL_ORG_POS, 
   VT_DEPL_AGENCY, 
   VT_SALVATION_ARMY_TRAINING, 
   VT_FEMA_TRAINING, 
   VT_GOV_TRAINING, 
   VT_CISM_TRAINING, 
   VT_OTHER_VOLUNTARY_TRAINING, 
   VT_QUALIFIED_COURSES, 
   VT_PROF_CERTIFICATIONS, 
   VT_SKILLS, 
   VT_AMATEUR_RADIO, 
   OTHER_LANGUAGES_SPOKEN, 
   VT_ADDITIONAL_EXPERIENCE, 
   VT_EMERG_CONTACT_NAME, 
   VT_EMERG_CONTACT_RELATIONSHIP, 
   VT_EMERG_CONTACT_PHONE, 
   VT_EMERG_CONTACT_ALT_PHONE, 
   VT_DR_LICENSE_ISSUING_STATE, 
   VT_DR_LICENSE_CLASS, 
   VT_DR_LICENSE_EXP_DATE, 
   VT_VEHICLES_AVAIL, 
   VT_VEHICLES_QUALIFIED, 
   VT_IS_DR_AUTHORIZED, 
   VT_IS_SIGNED_LIABILITY, 
   VT_IS_SIGNED_PHOTO_RELEASE, 
   VT_IS_ISSUED_CODE_OF_CONDUCT, 
   VT_IS_OK_WITH_CHILDREN, 
   CREATION_DATE, 
   CREATED_BY, 
   MODIFICATION_DATE, 
   MODIFIED_BY, 
   TIMEZONE)
AS 
   /*
   *   SSMA warning messages:
   *   O2SS0273: Oracle SUBSTR function and SQL Server SUBSTRING function may give different results.
   */

   SELECT 
      VT.VOLUNTEER_ID AS UNIQUE_KEY, 
      CASE REPT.STATUS
         WHEN 'O' THEN 'Yes'
         ELSE 'No'
      END AS HISTORY_VERSION, 
      CASE REPT.STATUS
         WHEN 'D' THEN 'Yes'
         ELSE 'No'
      END AS DELETED, 
      CASE REPT.CREATED_BY
         WHEN NULL THEN 'Yes'
         ELSE 'No'
      END AS FOREIGN_DOC, 
      REPT.WEB_PAGE_LINK, 
      DS.COMMENTS AS DATASHARE_COMMENTS, 
      CASE REPT.IS_OWNER
         WHEN 'Y' THEN 'Local'
         ELSE 'No'
      END AS OWNED_BY, 
      ISNULL(upper(substring(PV.COLOR_IMG_KEY, 7, (ssma_oracle.instr4_varchar(PV.COLOR_IMG_KEY, '.', 7, 1) - 7))), '') + ' - ' + ISNULL(PV.PICKLIST_VALUE, '') AS STATUS, 
      VT.VT_WORKER_CATEGORY, 
      VT.VT_LAST_NAME, 
      VT.VT_FIRST_NAME, 
      VT.VT_MIDDLE_INITIAL, 
      EMBCPROD.GET_RELATED_REPORT_VOLUNTEER(REPT.GLOBAL_REPORT_ID) AS RELATED_REPORT_NAME, 
      VT.VT_GENDER, 
      VT.VT_JOB_STATUS, 
      VT.VT_JOB_TITLE, 
      VT.VT_WORK_PHONE, 
      VT.VT_HOME_PHONE, 
      VT.VT_CELL_PHONE, 
      VT.VT_OTHER_PHONE, 
      VT.VT_EMAIL, 
      ORG.ORGANIZATION_NAME, 
      POS.POSITION_NAME, 
      VT.VT_AGENCY, 
      VT.VT_STREET_ADDRESS1, 
      VT.VT_STREET_ADDRESS2, 
      VT.VT_CITY, 
      VT.VT_STATE, 
      VT.VT_ZIP, 
      VT.VT_COUNTRY, 
      VT.VT_CITIZENSHIP, 
      VT.VT_PRIMARY_FUNCTION, 
      VT.VT_IS_PRIMARY_SUPERVISOR, 
      VT.VT_SECONDARY_FUNCTION, 
      VT.VT_IS_SECONDARY_SUPERVISOR, 
      VT.VT_DEPL_NOTIF_REQUIRED, 
      VT.VT_DEPL_AVAILABILITY, 
      VT.VT_DEPL_TEAM_NAME, 
      DEPL_ORG.ORGANIZATION_NAME AS DEPL_ORG_NAME, 
      DEPL_POS.POSITION_NAME AS DEPL_ORG_POS, 
      VT.VT_DEPL_AGENCY, 
      VT.VT_SALVATION_ARMY_TRAINING, 
      VT.VT_FEMA_TRAINING, 
      VT.VT_GOV_TRAINING, 
      VT.VT_CISM_TRAINING, 
      VT.VT_OTHER_VOLUNTARY_TRAINING, 
      VT.VT_QUALIFIED_COURSES, 
      VT.VT_PROF_CERTIFICATIONS, 
      VT.VT_SKILLS, 
      VT.VT_AMATEUR_RADIO, 
      VT.VT_LANG_SPOKEN AS OTHER_LANGUAGES_SPOKEN, 
      /* Other Language Spoken 2, Other Language Spoken 3*/VT.VT_ADDITIONAL_EXPERIENCE, 
      VT.VT_EMERG_CONTACT_NAME, 
      VT.VT_EMERG_CONTACT_RELATIONSHIP, 
      VT.VT_EMERG_CONTACT_PHONE, 
      VT.VT_EMERG_CONTACT_ALT_PHONE, 
      VT.VT_DR_LICENSE_ISSUING_STATE, 
      VT.VT_DR_LICENSE_CLASS, 
      VT.VT_DR_LICENSE_EXP_DATE, 
      VT.VT_VEHICLES_AVAIL, 
      VT.VT_VEHICLES_QUALIFIED, 
      VT.VT_IS_DR_AUTHORIZED, 
      VT.VT_IS_SIGNED_LIABILITY, 
      VT.VT_IS_SIGNED_PHOTO_RELEASE, 
      VT.VT_IS_ISSUED_CODE_OF_CONDUCT, 
      VT.VT_IS_OK_WITH_CHILDREN, 
      REPT.CREATION_DATE, 
      CASE 
         WHEN UC.USER_NAME IS NULL THEN 
            (
               SELECT TBL_REMOTE_DOCUMENT_USER_INFO.CREATED_BY_USER_LOGIN_ID
               FROM EMBCPROD.TBL_REMOTE_DOCUMENT_USER_INFO
               WHERE TBL_REMOTE_DOCUMENT_USER_INFO.GLOBAL_REPORT_ID = VT.VOLUNTEER_ID
            )
         ELSE UC.USER_NAME
      END AS CREATED_BY, 
      REPT.MODIFICATION_DATE, 
      CASE 
         WHEN UM.USER_NAME IS NULL THEN 
            (
               SELECT TBL_REMOTE_DOCUMENT_USER_INFO$2.MODIFIED_BY_USER_LOGIN_ID
               FROM EMBCPROD.TBL_REMOTE_DOCUMENT_USER_INFO  AS TBL_REMOTE_DOCUMENT_USER_INFO$2
               WHERE TBL_REMOTE_DOCUMENT_USER_INFO$2.GLOBAL_REPORT_ID = VT.VOLUNTEER_ID
            )
         ELSE UM.USER_NAME
      END AS MODIFIED_BY, 
      
         (
            SELECT TBL_EEMS_CONFIGURATION.CUSTOMER_TIMEZONE
            FROM EMBCPROD.TBL_EEMS_CONFIGURATION, EMBCPROD.TBL_REPORT
            WHERE TBL_EEMS_CONFIGURATION.CONFIGURATION_ID = TBL_REPORT.GLOBAL_REPORT_ID AND TBL_REPORT.STATUS = 'A'
         ) AS TIMEZONE
   FROM 
      (((((EMBCPROD.TBL_VOLUNTEER  AS VT 
         LEFT JOIN EMBCPROD.TBL_PICKLIST_VALUE  AS PV 
         ON VT.VT_STATUS = PV.PICKLIST_VALUE_ID) 
         LEFT JOIN EMBCPROD.TBL_ORGANIZATION  AS ORG 
         ON VT.VT_ORGANIZATION_ID = ORG.ORGANIZATION_ID) 
         LEFT JOIN EMBCPROD.TBL_ORGANIZATION_POSITIONS  AS POS 
         ON VT.VT_POSITION_ID = POS.POSITION_ID) 
         LEFT JOIN EMBCPROD.TBL_ORGANIZATION  AS DEPL_ORG 
         ON VT.VT_DEPL_ORGANIZATION_ID = DEPL_ORG.ORGANIZATION_ID) 
         LEFT JOIN EMBCPROD.TBL_ORGANIZATION_POSITIONS  AS DEPL_POS 
         ON VT.VT_DEPL_POSITION_ID = DEPL_POS.POSITION_ID), 
      (EMBCPROD.TBL_REPORT  AS REPT 
         LEFT JOIN EMBCPROD.TBL_DATA_SHARING  AS DS 
         ON REPT.DATA_SHARING_ID = DS.DATA_SHARING_ID) 
         LEFT JOIN EMBCPROD.TBL_RELATED_REPORT  AS RR 
         ON 
            REPT.GLOBAL_REPORT_ID = RR.GLOBAL_REPORT_ID AND 
            RR.RELATED_REPORT_TYPE = 'EIA' AND 
            RR.RELATED_GLOBAL_REPORT_ID IN 
            (
               SELECT TBL_REPORT$2.GLOBAL_REPORT_ID
               FROM EMBCPROD.TBL_REPORT  AS TBL_REPORT$2
               WHERE TBL_REPORT$2.STATUS IN ( 'A', 'C', 'D' )
            ) 
         LEFT JOIN EMBCPROD.TBL_REPORT  AS UCR 
         ON UCR.REPORT_ID = REPT.CREATED_BY 
         LEFT JOIN EMBCPROD.TBL_USER  AS UC 
         ON UCR.GLOBAL_REPORT_ID = UC.USER_ID AND UCR.STATUS IN ( 'A', 'D' ) 
         LEFT JOIN EMBCPROD.TBL_REPORT  AS UMR 
         ON UMR.REPORT_ID = REPT.MODIFIED_BY 
         LEFT JOIN EMBCPROD.TBL_USER  AS UM 
         ON UM.USER_ID = UMR.GLOBAL_REPORT_ID AND UMR.STATUS IN ( 'A', 'D' )
   WHERE VT.VOLUNTEER_ID = REPT.GLOBAL_REPORT_ID

GO
EXECUTE sp_addextendedproperty @name = N'MS_SSMA_SOURCE', @value = N'EMBCPROD.V_VOLUNTEER', @level0type = N'SCHEMA', @level0name = N'EMBCPROD', @level1type = N'VIEW', @level1name = N'V_VOLUNTEER';

