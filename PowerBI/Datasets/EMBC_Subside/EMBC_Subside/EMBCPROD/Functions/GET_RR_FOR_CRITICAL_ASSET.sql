CREATE FUNCTION [EMBCPROD].[GET_RR_FOR_CRITICAL_ASSET] 
( 
   @P_GLOBAL_REPORT_ID varchar(max)
)
RETURNS varchar(max)
AS 
   BEGIN

      DECLARE
         @V_RELATED_RESOURCE_NAME varchar(300)

      DECLARE
          C1 CURSOR LOCAL FOR 
            SELECT B.RELATED_REPORT_NAME
            FROM EMBCPROD.TBL_RELATED_REPORT  AS B
            WHERE B.GLOBAL_REPORT_ID = @P_GLOBAL_REPORT_ID AND B.RELATED_REPORT_TYPE = 'RESOURCEREQUEST'

      OPEN C1

      FETCH C1
          INTO @V_RELATED_RESOURCE_NAME

      CLOSE C1

      DEALLOCATE C1

      RETURN @V_RELATED_RESOURCE_NAME

   END

GO
EXECUTE sp_addextendedproperty @name = N'MS_SSMA_SOURCE', @value = N'EMBCPROD.GET_RR_FOR_CRITICAL_ASSET', @level0type = N'SCHEMA', @level0name = N'EMBCPROD', @level1type = N'FUNCTION', @level1name = N'GET_RR_FOR_CRITICAL_ASSET';

