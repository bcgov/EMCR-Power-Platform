CREATE    VIEW DBO.DOMINO_ERS_EXPORT
AS
SELECT DocID
	  ,FILEName
      ,ISNULL([Form], '') AS [Form]
      ,ISNULL([TaskCategory], '') AS [TaskCategory]
      ,ISNULL([IncidentType], '') AS [IncidentType]
      ,ISNULL([IncidentSubType], '') AS [IncidentSubType]
      ,ISNULL([IncidentNumber], '') AS [IncidentNumber]
      ,ISNULL([IncidentUpdateNo], '') AS [IncidentUpdateNo]
      ,ISNULL([IncidentTimeLogged], '') AS [IncidentTimeLogged]
      ,ISNULL([UpdateTimeLogged], '') AS [UpdateTimeLogged]
      ,ISNULL([ReportAuthor], '') AS [ReportAuthor]
      ,ISNULL([ReportAuthorPosition], '') AS [ReportAuthorPosition]
      ,ISNULL([Area], '') AS [Area]
      ,ISNULL([District], '') AS [District]
      ,ISNULL([OccurrenceRegion], '') AS [OccurrenceRegion]
      ,ISNULL([Caller], '') AS [Caller]
      ,ISNULL([Address], '') AS [Address]
      ,ISNULL([City], '') AS [City]
      ,ISNULL([PostalCode], '') AS [PostalCode]
      ,ISNULL([ReferredBy], '') AS [ReferredBy]
      ,ISNULL([PrimaryContactNoType], '') AS [PrimaryContactNoType]
      ,ISNULL([PrimaryContactNo], '') AS [PrimaryContactNo]
      ,ISNULL([AltContactNo1Type], '') AS [AltContactNo1Type]
      ,ISNULL([AltContactNo1], '') AS [AltContactNo1]
      ,ISNULL([AltContactNo2Type], '') AS [AltContactNo2Type]
      ,ISNULL([AltContactNo2], '') AS [AltContactNo2]
      ,ISNULL([AltContactNo3Type], '') AS [AltContactNo3Type]
      ,ISNULL([AltContactNo3], '') AS [AltContactNo3]
      ,ISNULL([Zone], '') AS [Zone]
      ,ISNULL([Zone2], '') AS [Zone2]
      ,ISNULL([notificationHistoryBasic], '') AS [notificationHistoryBasic]
      ,ISNULL([NtfReportData], '') AS [NtfReportData]
      ,ISNULL([ViolationDate], '') AS [ViolationDate]
      ,ISNULL([ViolationTime], '') AS [ViolationTime]
      ,ISNULL([ViolationProgress], '') AS [ViolationProgress]
      ,ISNULL([ViolationType], '') AS [ViolationType]
      ,ISNULL([OffenseWitnessed], '') AS [OffenseWitnessed]
      ,ISNULL([OffenseLocation], '') AS [OffenseLocation]
      ,ISNULL([OffenseDetails], '') AS [OffenseDetails]
      ,ISNULL([ViolatorName], '') AS [ViolatorName]
      ,ISNULL([Sex], '') AS [Sex]
      ,ISNULL([Eyes], '') AS [Eyes]
      ,ISNULL([Build], '') AS [Build]
      ,ISNULL([Race], '') AS [Race]
      ,ISNULL([Hair], '') AS [Hair]
      ,ISNULL([Complexion], '') AS [Complexion]
      ,ISNULL([Height], '') AS [Height]
      ,ISNULL([Glasses], '') AS [Glasses]
      ,ISNULL([Weight], '') AS [Weight]
      ,ISNULL([Smoker], '') AS [Smoker]
      ,ISNULL([Features], '') AS [Features]
      ,ISNULL([Clothing], '') AS [Clothing] 
      ,ISNULL([Vehicle], '') AS [Vehicle]
      ,ISNULL([Weapons], '') AS [Weapons]
      ,ISNULL([ViolationDetails], '') AS [ViolationDetails]
      ,ISNULL([ViolatorName_1], '') AS [ViolatorName_1]
      ,ISNULL([Sex_1], '') AS [Sex_1]
      ,ISNULL([Eyes_1], '') AS [Eyes_1]
      ,ISNULL([Build_1], '') AS [Build_1]
      ,ISNULL([Race_1], '') AS [Race_1]
      ,ISNULL([Hair_1], '') AS [Hair_1]
      ,ISNULL([Complexion_1], '') AS [Complexion_1]
      ,ISNULL([Height_1], '') AS [Height_1]
      ,ISNULL([Glasses_1], '') AS [Glasses_1]
      ,ISNULL([Weight_1], '') AS [Weight_1]
      ,ISNULL([Smoker_1], '') AS [Smoker_1]
      ,ISNULL([Features_1], '') AS [Features_1]
      ,ISNULL([Clothing_1], '') AS [Clothing_1]
      ,ISNULL([Vehicle_1], '') AS [Vehicle_1]
      ,ISNULL([Weapons_1], '') AS [Weapons_1]
      ,ISNULL([ViolationDetails_1], '') AS [ViolationDetails_1]
      ,ISNULL([ViolatorName_2], '') AS [ViolatorName_2]
      ,ISNULL([Sex_2], '') AS [Sex_2]
      ,ISNULL([Eyes_2], '') AS [Eyes_2]
      ,ISNULL([Build_2], '') AS [Build_2]
      ,ISNULL([Race_2], '') AS [Race_2]
      ,ISNULL([Hair_2], '') AS [Hair_2]
      ,ISNULL([Complexion_2], '') AS [Complexion_2]
      ,ISNULL([Height_2], '') AS [Height_2]
      ,ISNULL([Glasses_2], '') AS [Glasses_2]
      ,ISNULL([Weight_2], '') AS [Weight_2]
      ,ISNULL([Smoker_2], '') AS [Smoker_2]
      ,ISNULL([Features_2], '') AS [Features_2]
      ,ISNULL([Clothing_2], '') AS [Clothing_2]
      ,ISNULL([Vehicle_2], '') AS [Vehicle_2]
      ,ISNULL([Weapons_2], '') AS [Weapons_2]
      ,ISNULL([ViolationDetails_2], '') AS [ViolationDetails_2]
      ,ISNULL([ViolatorName_3], '') AS [ViolatorName_3]
      ,ISNULL([Sex_3], '') AS [Sex_3]
      ,ISNULL([Eyes_3], '') AS [Eyes_3]
      ,ISNULL([Build_3], '') AS [Build_3]
      ,ISNULL([Race_3], '') AS [Race_3]
      ,ISNULL([Hair_3], '') AS [Hair_3]
      ,ISNULL([Complexion_3], '') AS [Complexion_3]
      ,ISNULL([Height_3], '') AS [Height_3]
      ,ISNULL([Glasses_3], '') AS [Glasses_3]
      ,ISNULL([Weight_3], '') AS [Weight_3]
      ,ISNULL([Smoker_3], '') AS [Smoker_3]
      ,ISNULL([Features_3], '') AS [Features_3]
      ,ISNULL([Clothing_3], '') AS [Clothing_3]
      ,ISNULL([Vehicle_3], '') AS [Vehicle_3]
      ,ISNULL([Weapons_3], '') AS [Weapons_3]
      ,ISNULL([ViolationDetails_3], '') AS [ViolationDetails_3]
      ,ISNULL([ViolatorName_4], '') AS [ViolatorName_4]
      ,ISNULL([Sex_4], '') AS [Sex_4]
      ,ISNULL([Eyes_4], '') AS [Eyes_4]
      ,ISNULL([Build_4], '') AS [Build_4]
      ,ISNULL([Race_4], '') AS [Race_4]
      ,ISNULL([Hair_4], '') AS [Hair_4]
      ,ISNULL([Complexion_4], '') AS [Complexion_4]
      ,ISNULL([Height_4], '') AS [Height_4]
      ,ISNULL([Glasses_4], '') AS [Glasses_4]
      ,ISNULL([Weight_4], '') AS [Weight_4]
      ,ISNULL([Smoker_4], '') AS [Smoker_4]
      ,ISNULL([Features_4], '') AS [Features_4]
      ,ISNULL([Clothing_4], '') AS [Clothing_4]
      ,ISNULL([Vehicle_4], '') AS [Vehicle_4]
      ,ISNULL([Weapons_4], '') AS [Weapons_4]
      ,ISNULL([ViolationDetails_4], '') AS [ViolationDetails_4]
FROM (SELECT s.DocId,FILEName, S.FormName, JSON_VALUE(j.value, '$.Name')as Name, JSON_VALUE(j.value, '$.Text') as Text
	  FROM dbo.DominoData s
	  CROSS APPLY openjson(s.FormData) j
	  WHERE 1=1
	  	AND FileName LIKE 'ECCLog_FY%\%Incident.nsf'
	  	AND FormName in ('ERS','ERSUpdate', 'ERSOutcome')
) AS Src
PIVOT(
	MAX(Text)
	FOR Name IN (
	[Form],[TaskCategory],[IncidentType],[IncidentSubType],[IncidentNumber],[IncidentUpdateNo],[IncidentTimeLogged],[UpdateTimeLogged],[ReportAuthor],[ReportAuthorPosition],[Area],[District],[OccurrenceRegion],[Caller],[Address],[City],[PostalCode],[ReferredBy],[PrimaryContactNoType],[PrimaryContactNo],[AltContactNo1Type],[AltContactNo1],[AltContactNo2Type],[AltContactNo2],[AltContactNo3Type],[AltContactNo3],[Zone],[Zone2],[notificationHistoryBasic],[NtfReportData],[ViolationDate],[ViolationTime],[ViolationProgress],[ViolationType],[OffenseWitnessed],[OffenseLocation],[OffenseDetails],[ViolatorName],[Sex],[Eyes],[Build],[Race],[Hair],[Complexion],[Height],[Glasses],[Weight],[Smoker],[Features],[Clothing],[Vehicle],[Weapons],[ViolationDetails],[ViolatorName_1],[Sex_1],[Eyes_1],[Build_1],[Race_1],[Hair_1],[Complexion_1],[Height_1],[Glasses_1],[Weight_1],[Smoker_1],[Features_1],[Clothing_1],[Vehicle_1],[Weapons_1],[ViolationDetails_1],[ViolatorName_2],[Sex_2],[Eyes_2],[Build_2],[Race_2],[Hair_2],[Complexion_2],[Height_2],[Glasses_2],[Weight_2],[Smoker_2],[Features_2],[Clothing_2],[Vehicle_2],[Weapons_2],[ViolationDetails_2],[ViolatorName_3],[Sex_3],[Eyes_3],[Build_3],[Race_3],[Hair_3],[Complexion_3],[Height_3],[Glasses_3],[Weight_3],[Smoker_3],[Features_3],[Clothing_3],[Vehicle_3],[Weapons_3],[ViolationDetails_3],[ViolatorName_4],[Sex_4],[Eyes_4],[Build_4],[Race_4],[Hair_4],[Complexion_4],[Height_4],[Glasses_4],[Weight_4],[Smoker_4],[Features_4],[Clothing_4],[Vehicle_4],[Weapons_4],[ViolationDetails_4]
)) as Pvt