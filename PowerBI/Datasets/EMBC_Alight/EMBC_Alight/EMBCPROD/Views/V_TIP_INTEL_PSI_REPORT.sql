CREATE VIEW EMBCPROD.V_TIP_INTEL_PSI_REPORT (
   UNIQUE_KEY, 
   HISTORY_VERSION, 
   DELETED, 
   FOREIGN_DOC, 
   WEB_PAGE_LINK, 
   OWNED_BY, 
   COL_TIPINTELPARENTID, 
   TIP_INTEL_PSI_REPORT_TYPE, 
   COL_TIPPSIDATE, 
   COL_TIPPSIPROTECTED, 
   COL_TIPPSILASTNAME, 
   COL_TIPPSIDOB, 
   COL_TIPPSIFIRSTNAME, 
   COL_TIPPSIAGE, 
   COL_TIPPSIMIDDLENAME, 
   COL_TIPPSISSN, 
   COL_TIPPSIALIAS, 
   COL_TIPPSIOLNSTATE, 
   COL_TIPPSIOLNNUMBER, 
   COL_TIPPSIRACE, 
   COL_TIPPSINATIONALITY, 
   COL_TIPPSIGENDER, 
   COL_TIPPSICOB, 
   COL_TIPPSIHEIGHT, 
   COL_TIPPSISOB, 
   COL_TIPPSIWEIGHT, 
   COL_TIPPSICIOB, 
   COL_TIPPSICRIMINALHISTORY, 
   COL_TIPPSICREDIBILITY, 
   COL_TIPPSIVALIDITY, 
   COL_TIPPSIADDITIONALINFO, 
   COL_TIPPSIHOMEPHONE, 
   COL_TIPPSIWORKPHONE, 
   COL_TIPPSICELLPHONE, 
   COL_TIPPSIFAXPHONE, 
   COL_TIPPSIOTHERPHONE, 
   COL_TIPPSIEMAIL, 
   COL_TIPPSIWEBSITEURL, 
   COL_TIPPSIV1TYPE, 
   COL_TIPPSIV1MAKE, 
   COL_TIPPSIV1MODEL, 
   COL_TIPPSIV1YEAR, 
   COL_TIPPSIV1COLOR, 
   COL_TIPPSIV1TAGNO, 
   COL_TIPPSIV1STATE, 
   COL_TIPPSIV1VIN, 
   COL_TIPPSIV2TYPE, 
   COL_TIPPSIV2MAKE, 
   COL_TIPPSIV2MODEL, 
   COL_TIPPSIV2YEAR, 
   COL_TIPPSIV2COLOR, 
   COL_TIPPSIV2TAGNO, 
   COL_TIPPSIV2STATE, 
   COL_TIPPSIV2VIN, 
   COL_TIPPSIV3TYPE, 
   COL_TIPPSIV3MAKE, 
   COL_TIPPSIV3MODEL, 
   COL_TIPPSIV3YEAR, 
   COL_TIPPSIV3COLOR, 
   COL_TIPPSIV3TAGNO, 
   COL_TIPPSIV3STATE, 
   COL_TIPPSIV3VIN, 
   COL_TIPPSIV4TYPE, 
   COL_TIPPSIV4MAKE, 
   COL_TIPPSIV4MODEL, 
   COL_TIPPSIV4YEAR, 
   COL_TIPPSIV4COLOR, 
   COL_TIPPSIV4TAGNO, 
   COL_TIPPSIV4STATE, 
   COL_TIPPSIV4VIN, 
   COL_TIPPSIV5TYPE, 
   COL_TIPPSIV5MAKE, 
   COL_TIPPSIV5MODEL, 
   COL_TIPPSIV5YEAR, 
   COL_TIPPSIV5COLOR, 
   COL_TIPPSIV5TAGNO, 
   COL_TIPPSIV5STATE, 
   COL_TIPPSIV5VIN, 
   COL_TIPPSIADDRESS, 
   COL_TIPPSIPOBOX, 
   COL_TIPPSICITY, 
   COL_TIPPSISTATE, 
   COL_TIPPSIZIP, 
   COL_TIPPSICOUNTRY, 
   COL_TIPPSIEMPLOYER, 
   COL_TIPPSIEMPADDRESS, 
   COL_TIPPSIEMPPOBOX, 
   COL_TIPPSIEMPCITY, 
   COL_TIPPSIEMPSTATE, 
   COL_TIPPSIEMPZIP, 
   COL_TIPPSIEMPCOUNTRY, 
   COL_TIPPSIEMPEMAIL, 
   COL_TIPPSIEMPHOME, 
   COL_TIPPSIEMPWORK, 
   COL_TIPPSIEMPCELL, 
   COL_TIPPSIEMPFAX, 
   COL_TIPPSIEMPOTHER, 
   COL_TIPPSIEMPWEBSITE, 
   COL_TIPPSIEMPADDITIONALINFO, 
   SITE_NAME, 
   SITE_TYPE, 
   STREET_ADDRESS, 
   APT_LOT_NO, 
   CITY, 
   COUNTRY_NAME, 
   COUNTY_NAME, 
   GEO_AREA, 
   STATE_NAME, 
   ZIP_CODE, 
   INTERSECTION_STREET1, 
   INTERSECTION_STREET2, 
   ADDITIONAL_INFO, 
   SHOW_ON_MAP, 
   LATITUDE, 
   LONGITUDE, 
   F_LATITUDE, 
   F_LONGITUDE, 
   GEO_LOCATED_BY, 
   CREATION_DATE, 
   CREATED_BY, 
   MODIFICATION_DATE, 
   MODIFIED_BY, 
   TIMEZONE)
AS 
   SELECT 
      PSI.TIP_INTEL_PSI_REPORT_ID AS UNIQUE_KEY, 
      CASE REPT.STATUS
         WHEN 'O' THEN 'Yes'
         ELSE 'No'
      END AS HISTORY_VERSION, 
      CASE REPT.STATUS
         WHEN 'D' THEN 'Yes'
         ELSE 'No'
      END AS DELETED, 
      CASE REPT.CREATED_BY
         WHEN NULL THEN 'Yes'
         ELSE 'No'
      END AS FOREIGN_DOC, 
      REPT.WEB_PAGE_LINK, 
      CASE REPT.IS_OWNER
         WHEN 'Y' THEN 'Local'
         ELSE 'No'
      END AS OWNED_BY, 
      PSI.COL_TIPINTELPARENTID, 
      PSI.TIP_INTEL_PSI_REPORT_TYPE, 
      PSI.COL_TIPPSIDATE, 
      PSI.COL_TIPPSIPROTECTED, 
      PSI.COL_TIPPSILASTNAME, 
      PSI.COL_TIPPSIDOB, 
      PSI.COL_TIPPSIFIRSTNAME, 
      PSI.COL_TIPPSIAGE, 
      PSI.COL_TIPPSIMIDDLENAME, 
      PSI.COL_TIPPSISSN, 
      PSI.COL_TIPPSIALIAS, 
      PSI.COL_TIPPSIOLNSTATE, 
      PSI.COL_TIPPSIOLNNUMBER, 
      PSI.COL_TIPPSIRACE, 
      PSI.COL_TIPPSINATIONALITY, 
      PSI.COL_TIPPSIGENDER, 
      PSI.COL_TIPPSICOB, 
      PSI.COL_TIPPSIHEIGHT, 
      PSI.COL_TIPPSISOB, 
      PSI.COL_TIPPSIWEIGHT, 
      PSI.COL_TIPPSICIOB, 
      PSI.COL_TIPPSICRIMINALHISTORY, 
      PSI.COL_TIPPSICREDIBILITY, 
      PSI.COL_TIPPSIVALIDITY, 
      PSI.COL_TIPPSIADDITIONALINFO, 
      PSI.COL_TIPPSIHOMEPHONE, 
      PSI.COL_TIPPSIWORKPHONE, 
      PSI.COL_TIPPSICELLPHONE, 
      PSI.COL_TIPPSIFAXPHONE, 
      PSI.COL_TIPPSIOTHERPHONE, 
      PSI.COL_TIPPSIEMAIL, 
      PSI.COL_TIPPSIWEBSITEURL, 
      PSI.COL_TIPPSIV1TYPE, 
      PSI.COL_TIPPSIV1MAKE, 
      PSI.COL_TIPPSIV1MODEL, 
      PSI.COL_TIPPSIV1YEAR, 
      PSI.COL_TIPPSIV1COLOR, 
      PSI.COL_TIPPSIV1TAGNO, 
      PSI.COL_TIPPSIV1STATE, 
      PSI.COL_TIPPSIV1VIN, 
      PSI.COL_TIPPSIV2TYPE, 
      PSI.COL_TIPPSIV2MAKE, 
      PSI.COL_TIPPSIV2MODEL, 
      PSI.COL_TIPPSIV2YEAR, 
      PSI.COL_TIPPSIV2COLOR, 
      PSI.COL_TIPPSIV2TAGNO, 
      PSI.COL_TIPPSIV2STATE, 
      PSI.COL_TIPPSIV2VIN, 
      PSI.COL_TIPPSIV3TYPE, 
      PSI.COL_TIPPSIV3MAKE, 
      PSI.COL_TIPPSIV3MODEL, 
      PSI.COL_TIPPSIV3YEAR, 
      PSI.COL_TIPPSIV3COLOR, 
      PSI.COL_TIPPSIV3TAGNO, 
      PSI.COL_TIPPSIV3STATE, 
      PSI.COL_TIPPSIV3VIN, 
      PSI.COL_TIPPSIV4TYPE, 
      PSI.COL_TIPPSIV4MAKE, 
      PSI.COL_TIPPSIV4MODEL, 
      PSI.COL_TIPPSIV4YEAR, 
      PSI.COL_TIPPSIV4COLOR, 
      PSI.COL_TIPPSIV4TAGNO, 
      PSI.COL_TIPPSIV4STATE, 
      PSI.COL_TIPPSIV4VIN, 
      PSI.COL_TIPPSIV5TYPE, 
      PSI.COL_TIPPSIV5MAKE, 
      PSI.COL_TIPPSIV5MODEL, 
      PSI.COL_TIPPSIV5YEAR, 
      PSI.COL_TIPPSIV5COLOR, 
      PSI.COL_TIPPSIV5TAGNO, 
      PSI.COL_TIPPSIV5STATE, 
      PSI.COL_TIPPSIV5VIN, 
      PSI.COL_TIPPSIADDRESS, 
      PSI.COL_TIPPSIPOBOX, 
      PSI.COL_TIPPSICITY, 
      PSI.COL_TIPPSISTATE, 
      PSI.COL_TIPPSIZIP, 
      PSI.COL_TIPPSICOUNTRY, 
      PSI.COL_TIPPSIEMPLOYER, 
      PSI.COL_TIPPSIEMPADDRESS, 
      PSI.COL_TIPPSIEMPPOBOX, 
      PSI.COL_TIPPSIEMPCITY, 
      PSI.COL_TIPPSIEMPSTATE, 
      PSI.COL_TIPPSIEMPZIP, 
      PSI.COL_TIPPSIEMPCOUNTRY, 
      PSI.COL_TIPPSIEMPEMAIL, 
      PSI.COL_TIPPSIEMPHOME, 
      PSI.COL_TIPPSIEMPWORK, 
      PSI.COL_TIPPSIEMPCELL, 
      PSI.COL_TIPPSIEMPFAX, 
      PSI.COL_TIPPSIEMPOTHER, 
      PSI.COL_TIPPSIEMPWEBSITE, 
      PSI.COL_TIPPSIEMPADDITIONALINFO, 
      L.SITE_NAME, 
      L.SITE_TYPE, 
      L.STREET_ADDRESS, 
      L.APT_LOT_NO, 
      L.CITY, 
      L.COUNTRY_NAME, 
      L.COUNTY_NAME, 
      L.GEO_AREA, 
      L.STATE_NAME, 
      L.ZIP_CODE, 
      L.INTERSECTION_STREET1, 
      L.INTERSECTION_STREET2, 
      L.ADDITIONAL_INFO, 
      G.SHOW_ON_MAP, 
      G.LATITUDE, 
      G.LONGITUDE, 
      CAST(G.LATITUDE AS float(53)) AS F_LATITUDE, 
      CAST(G.LONGITUDE AS float(53)) AS F_LONGITUDE, 
      G.GEO_LOCATED_BY, 
      REPT.CREATION_DATE, 
      CASE 
         WHEN UC.USER_NAME IS NULL THEN 
            (
               SELECT TBL_REMOTE_DOCUMENT_USER_INFO.CREATED_BY_USER_LOGIN_ID
               FROM EMBCPROD.TBL_REMOTE_DOCUMENT_USER_INFO
               WHERE TBL_REMOTE_DOCUMENT_USER_INFO.GLOBAL_REPORT_ID = PSI.TIP_INTEL_PSI_REPORT_ID
            )
         ELSE UC.USER_NAME
      END AS CREATED_BY, 
      REPT.MODIFICATION_DATE, 
      CASE 
         WHEN UM.USER_NAME IS NULL THEN 
            (
               SELECT TBL_REMOTE_DOCUMENT_USER_INFO$2.MODIFIED_BY_USER_LOGIN_ID
               FROM EMBCPROD.TBL_REMOTE_DOCUMENT_USER_INFO  AS TBL_REMOTE_DOCUMENT_USER_INFO$2
               WHERE TBL_REMOTE_DOCUMENT_USER_INFO$2.GLOBAL_REPORT_ID = PSI.TIP_INTEL_PSI_REPORT_ID
            )
         ELSE UM.USER_NAME
      END AS MODIFIED_BY, 
      
         (
            SELECT TBL_EEMS_CONFIGURATION.CUSTOMER_TIMEZONE
            FROM EMBCPROD.TBL_EEMS_CONFIGURATION, EMBCPROD.TBL_REPORT
            WHERE TBL_EEMS_CONFIGURATION.CONFIGURATION_ID = TBL_REPORT.GLOBAL_REPORT_ID AND TBL_REPORT.STATUS = 'A'
         ) AS TIMEZONE
   FROM 
      EMBCPROD.TBL_TIP_INTEL_PSI_REPORT  AS PSI, 
      ((EMBCPROD.TBL_REPORT  AS REPT 
         LEFT JOIN EMBCPROD.TBL_LOCATION  AS L 
         ON REPT.LOCATION_ID = L.LOCATION_ID) 
         LEFT JOIN EMBCPROD.TBL_GEO_LOCATION_MAPPING  AS G 
         ON REPT.GEO_LOCATION_MAPPING_ID = G.GEO_LOCATION_MAPPING_ID) 
         LEFT JOIN EMBCPROD.TBL_REPORT  AS UCR 
         ON UCR.REPORT_ID = REPT.CREATED_BY 
         LEFT JOIN EMBCPROD.TBL_USER  AS UC 
         ON UCR.GLOBAL_REPORT_ID = UC.USER_ID AND UCR.STATUS IN ( 'A', 'D' ) 
         LEFT JOIN EMBCPROD.TBL_REPORT  AS UMR 
         ON UMR.REPORT_ID = REPT.MODIFIED_BY 
         LEFT JOIN EMBCPROD.TBL_USER  AS UM 
         ON UM.USER_ID = UMR.GLOBAL_REPORT_ID AND UMR.STATUS IN ( 'A', 'D' )
   WHERE PSI.TIP_INTEL_PSI_REPORT_ID = REPT.GLOBAL_REPORT_ID
GO
EXECUTE sp_addextendedproperty @name = N'MS_SSMA_SOURCE', @value = N'EMBCPROD.V_TIP_INTEL_PSI_REPORT', @level0type = N'SCHEMA', @level0name = N'EMBCPROD', @level1type = N'VIEW', @level1name = N'V_TIP_INTEL_PSI_REPORT';

